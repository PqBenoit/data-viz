extends ../layout

block content
	script(src='/javascripts/raphael.js')
	script(src='https://cdn.socket.io/socket.io-1.3.3.js')
	section(id="container", class="tweets")
		div(id="map")
		aside(class="tweetSlide")
			i(class="fa fa-angle-double-right")
			div(class="tweet-content")
	script(src='/javascripts/map.js')
	script(src='/javascripts/aside.js')
	script(type='text/javascript').
		$(document).ready(function() {

			Aside.init();
			Map.init();

			var socket = io.connect('http://localhost:3000');

			socket.on('tweet', function(data){
				var circle = undefined;

				if (null!=data.tweet.coordinates) {
					var pos = Map.getPixelPosition(Map.rsr, data.tweet.coordinates.coordinates[0], data.tweet.coordinates.coordinates[1]);
					console.log(data.tweet.coordinates.coordinates);
					circle = Map.rsr.circle(pos.x, pos.y, 10);
					circle.attr('fill', '#4099FF');
					circle.attr('stroke', 'none');
					
					$(circle.node).click(function(){
						Aside.open($(this).offset().left, $(this).offset().top, data);
					});
				}
			});

			$('.fa-angle-double-right').click(function(){
				Aside.close();
			});

		});